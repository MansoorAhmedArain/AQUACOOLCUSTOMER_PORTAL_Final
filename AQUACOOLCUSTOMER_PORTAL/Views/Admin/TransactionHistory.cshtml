@model IEnumerable<AQUACOOLCUSTOMER_PORTAL.DTO.AxPayments>
@using AQUACOOLCUSTOMER_PORTAL.DTO
@{
    ViewData["Title"] = "TransactionHistory";
}
<head>
    <!-- Basic -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!-- Mobile Metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <!-- Site Metas -->
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <link rel="shortcut icon" href="images/fevicon.png" type="">

    <title>Transaction History</title>


    <!-- bootstrap core css -->
    <link rel="stylesheet" type="text/css" href="css/bootstrapcss/bootstrap.min.css" />


    <!-- fonts style -->
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">

    <!-- font awesome style -->
    <link href="css/font-awesome.min.css" rel="stylesheet" />

    <!-- Custom styles for this template -->
    <link href="~/css/TransactionHistory/style.css" rel="stylesheet" />
    <!-- responsive style -->
    <link href="~/css/TransactionHistory/responsive.css" rel="stylesheet" />

</head>
<main>
    <div class="bg-container d-md-flex">
        <div class="left-box"><img src="/images/BG18.jpg" class="rounded-start rounded-pill img-style" alt=""></div>
        <div class="right-box pt-4">
            <div class="icon-text h4">
                <span style="white-space: nowrap;">Transaction History</span>
            </div>
            <div class="mt-3 input-style">
                <div class="input-group mb-3">
                    @*  <input type="text" class="form-control rounded-pill" name="EAG" style="border: 1px solid #8FD2F0;"> *@
                    <select class="form-control  rounded-pill" required placeholder="Select" name="EAG" style="border: 1px solid #8FD2F0;" id="EAGContractDropdown">
                        <option value="">Select a contract</option>
                        @{
                            foreach (var item in (List<ContractIDs>)ViewBag.ContractsList)
                            {
                                <option value="@item.ID">@item.Name</option>
                            }
                        }
                    </select>
                </div>
               @*  <div style="color: #03213d; font-size: small;">You have no outstanding bills</div> *@
                <div style="color: #03213d; font-size: small; font-weight: bolder;">Balance & Latest Bills: @ViewBag.SelectedContractEAG</div>
                <table class="mt-2">
                    <tbody>
                        <tr>
                            <td class="table-row">AED @ViewBag.CustOutstandingBalance <br><span style=" font-size: x-small; color: #888;">Balance Due</span></td>
                            <td class="table-row">AED @ViewBag.SelectedContractAmount <br><span style=" font-size: x-small; color: #888;">Latest Bill</span></td>
                            <td class="table-row">@ViewBag.SelectedContractDueDate <br><span style=" font-size: x-small; color: #888;">Due Date</span></td>
                        </tr>
                    </tbody>
                </table>

                <div class="table-wrapper mt-4">

                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Amount</th>
                                <th>Type</th>
                                <th>Trans Number</th>
                                <th>Receipt</th>
                            </tr>
                        </thead>
                        @foreach (var item in Model)
                        {
                            <tbody>
                                <tr>
                                    <td>@item.Date.ToShortDateString()</td>
                                    <td>@item.Amount</td>
                                    <td>@item.PayAgainst</td>
                                    <td>@item.TransNumberDescription</td>
                                    <td>
                                        @if(string.IsNullOrEmpty(item.TransNumberDescription))
                                        {
                                            <a href="@Url.Action("getpaymentReceiptPDF", "admin", new{contract = @ViewBag.SelectedContractEAG, date = item.Date.ToShortDateString() })" style="text-decoration:none; color:#009ADE">download@* <i class='fas fa-receipt' style="font-size:18px; color:#009ADE"></i> *@</a>
                                        }
                                        else
                                        {
                                            <span> - </span>
                                        }
                                       
                                    </td>
                                </tr>
                            </tbody>
                        }
                    </table>
                </div>
            </div>
        </div>
    </div>
</main>
<script>
    document.getElementById("EAGContractDropdown").addEventListener("change", function () {
        var selectedValue = this.value;
        if (selectedValue) {
            // Reload the page with the selected contractId as query parameter
            window.location.href = "?contractId=" + encodeURIComponent(selectedValue);
        }
    });
</script>